<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Image Voting Dashboard</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#6ee7b7}
    *{box-sizing:border-box;transition:all 0.3s ease}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:linear-gradient(180deg,#071129 0%,#0b1220 100%);color:#e6eef6}
    .container{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .uploader, .dashboard, .gallery{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,.6)}
    .uploader{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .uploader input[type=file]{display:block}
    .btn{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;cursor:pointer;color:#05201a;font-weight:600}
    .btn:hover{transform:scale(1.05)}
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px;margin-top:12px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));padding:8px;border-radius:10px;display:flex;flex-direction:column;gap:8px;transition:transform .2s}
    .card:hover{transform:translateY(-4px)}
    .thumb{aspect-ratio:1.4/1;border-radius:8px;overflow:hidden;background:#08101a;display:flex;align-items:center;justify-content:center}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .meta{display:flex;justify-content:space-between;align-items:center;font-size:13px;color:var(--muted)}
    .vote-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .small{font-size:12px;color:var(--muted)}
    .dashboard-grid{display:grid;grid-template-columns:1fr 280px;gap:12px}
    .stats{display:flex;flex-direction:column;gap:8px}
    .stat{background:rgba(255,255,255,.02);padding:10px;border-radius:8px}
    canvas{width:100%;height:150px;background:transparent}
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
    @media (max-width:900px){.dashboard-grid{grid-template-columns:1fr}}
    .name-input{padding:6px;border-radius:6px;border:none;width:160px}
    .delete-btn{background:#ff6b6b;color:#fff}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Image Voting Dashboard</h1>
      <div class="small">Live sync across tabs (same browser) • Upload up to 5 images</div>
    </header>

    <section class="uploader">
      <div>
        <label class="small">Choose image to upload</label><br />
        <input id="fileInput" type="file" accept="image/*" />
      </div>
      <div>
        <label class="small">Image name</label><br />
        <input id="nameInput" class="name-input" type="text" placeholder="Enter name" />
      </div>
      <div class="controls">
        <button id="uploadBtn" class="btn">Upload</button>
        <button id="clearBtn" class="btn" style="background:#ffb4a2">Clear All</button>
      </div>
    </section>

    <section style="height:18px"></section>

    <section class="dashboard">
      <div class="dashboard-grid">
        <div>
          <h3 style="margin:0 0 8px 0">Gallery</h3>
          <div id="gallery" class="grid"></div>
        </div>
        <aside>
          <h3 style="margin:0 0 8px 0">Live Dashboard</h3>
          <div class="stats">
            <div id="totalImages" class="stat">Total images: 0</div>
            <div id="totalVotes" class="stat">Total votes: 0</div>
            <div id="topImage" class="stat">Top image: —</div>
            <div class="stat">
              <div class="small">Vote distribution</div>
              <canvas id="chart"></canvas>
            </div>
          </div>
        </aside>
      </div>
    </section>

    <footer>
      Tip: open this file in two tabs to test "live" updates between users in the same browser.
    </footer>
  </div>

<script>
const STORAGE_KEY = 'imageVoting.images.v1';
const channel = new BroadcastChannel('image-vote-channel');

const uid = ()=>Date.now().toString(36)+Math.random().toString(36).slice(2,8);
function saveImages(imgs){localStorage.setItem(STORAGE_KEY, JSON.stringify(imgs));channel.postMessage({type:'sync',images:imgs});}
function loadImages(){try{return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]')}catch(e){return []}}

const fileInput = document.getElementById('fileInput');
const nameInput = document.getElementById('nameInput');
const uploadBtn = document.getElementById('uploadBtn');
const clearBtn = document.getElementById('clearBtn');
const gallery = document.getElementById('gallery');
const totalImages = document.getElementById('totalImages');
const totalVotes = document.getElementById('totalVotes');
const topImage = document.getElementById('topImage');
const chart = document.getElementById('chart');

function render(){
  const imgs = loadImages();
  gallery.innerHTML = '';
  imgs.forEach(img=>{
    const card = document.createElement('div');card.className='card';
    const thumb = document.createElement('div');thumb.className='thumb';
    const i = document.createElement('img'); i.src = img.data; i.alt = img.name;
    thumb.appendChild(i);
    const meta = document.createElement('div');meta.className='meta';
    const name = document.createElement('div');name.textContent = img.name||'Untitled';
    const votes = document.createElement('div');votes.textContent = img.votes+' votes';
    meta.appendChild(name);meta.appendChild(votes);

    const row = document.createElement('div');row.className='vote-row';
    const up = document.createElement('button');up.className='btn';up.textContent='Vote';
    up.onclick = ()=>{vote(img.id)};
    const down = document.createElement('button');down.className='btn';down.style.background='#f3a683';down.textContent='-1';
    down.onclick = ()=>{vote(img.id,-1)};
    const del = document.createElement('button');del.className='btn delete-btn';del.textContent='Delete';
    del.onclick = ()=>{deleteImage(img.id)};
    row.appendChild(up);row.appendChild(down);row.appendChild(del);

    card.appendChild(thumb);card.appendChild(meta);card.appendChild(row);
    gallery.appendChild(card);
  });

  totalImages.textContent = 'Total images: '+imgs.length;
  const total = imgs.reduce((s,i)=>s+i.votes,0);
  totalVotes.textContent = 'Total votes: '+total;
  const sorted = [...imgs].sort((a,b)=>b.votes-a.votes);
  topImage.textContent = 'Top image: '+(sorted[0]?`${sorted[0].name} (${sorted[0].votes} votes)`:'—');

  renderChart(imgs);
}

function renderChart(imgs){
  const ctx = chart.getContext('2d');
  const DPR = window.devicePixelRatio||1;
  chart.width = chart.clientWidth*DPR;
  chart.height = 150*DPR;
  ctx.clearRect(0,0,chart.width,chart.height);
  if(imgs.length===0) return;
  const total = imgs.reduce((s,i)=>s+i.votes,0) || 1;
  const barW = chart.width / imgs.length - 10*DPR;
  imgs.forEach((img,idx)=>{
    const h = (img.votes/total)*chart.height*0.85;
    const x = idx*(barW+10*DPR)+8*DPR;
    const y = chart.height - h - 20*DPR;
    const hue = (idx*65)%360;
    ctx.fillStyle = `hsl(${hue} 80% 60%)`;
    ctx.fillRect(x,y,barW,h);
    ctx.fillStyle = 'rgba(230,238,246,0.9)';
    ctx.font = `${12*DPR}px sans-serif`;
    const label = (img.name||'Img').slice(0,10);
    ctx.fillText(label, x, chart.height - 6*DPR);
  });
}

function vote(id,delta=1){
  const imgs = loadImages();
  const idx = imgs.findIndex(i=>i.id===id); if(idx===-1) return;
  imgs[idx].votes = Math.max(0, (imgs[idx].votes||0)+delta);
  saveImages(imgs);
  render();
}

function deleteImage(id){
  let imgs = loadImages();
  imgs = imgs.filter(i=>i.id!==id);
  saveImages(imgs);
  render();
}

uploadBtn.onclick = ()=>{
  const f = fileInput.files && fileInput.files[0];
  if(!f) return alert('Please choose an image file.');
  const imgs = loadImages();
  if(imgs.length>=5){
    alert('You can only upload up to 5 images.');
    return;
  }
  const customName = nameInput.value.trim() || f.name;
  const reader = new FileReader();
  reader.onload = ()=>{
    imgs.unshift({id:uid(),name:customName,data:reader.result,votes:0,uploadedAt:Date.now()});
    saveImages(imgs);
    fileInput.value='';
    nameInput.value='';
    render();
  };
  reader.readAsDataURL(f);
};

clearBtn.onclick = ()=>{
  if(!confirm('Clear all stored images and votes?')) return;
  localStorage.removeItem(STORAGE_KEY);
  channel.postMessage({type:'clear'});
  render();
}

channel.onmessage = (ev)=>{
  const msg = ev.data;
  if(msg && msg.type==='sync'){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(msg.images||[]));
    render();
  }
  if(msg && msg.type==='clear'){
    localStorage.removeItem(STORAGE_KEY); render();
  }
}

window.addEventListener('storage', (e)=>{
  if(e.key===STORAGE_KEY) render();
});

function seedIfEmpty(){
  const imgs = loadImages();
  if(imgs.length===0){
    const colors = ['#ff7675','#6c5ce7','#74b9ff','#55efc4','#ffeaa7'];
    colors.slice(0,5).forEach((c,i)=>{
      const svg = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"800\" height=\"500\"><rect width=\"100%\" height=\"100%\" fill=\"${c}\"/><text x=\"50%\" y=\"50%\" font-size=\"48\" fill=\"#012\" text-anchor=\"middle\" dominant-baseline=\"middle\">Demo ${i+1}</text></svg>`;
      const data = 'data:image/svg+xml;utf8,'+encodeURIComponent(svg);
      imgs.push({id:uid(),name:`Demo ${i+1}`,data,votes:Math.floor(Math.random()*6),uploadedAt:Date.now()-i*1000});
    });
    saveImages(imgs);
  }
}

seedIfEmpty();
render();
</script>
</body>
</html>
